// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ENGINEER
  ADMIN
  MANAGER
}

enum AssetCategory {
  ATV
  UTV
  SEA_SPORT
  POOL_TOYS
  LINE_SPORT
}

enum AssetStatus {
  ACTIVE
  MAINTENANCE
  RETIRED
}

enum MaintenanceType {
  PREVENTIVE
  CORRECTIVE
}

enum ExpenseCategory {
  OPERATIONAL
  PERSONNEL
  MARKETING
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
}

model User {
  id                      String           @id @default(uuid())
  email                   String           @unique
  passwordHash            String           @map("password_hash")
  name                    String
  role                    UserRole
  createdAt               DateTime         @default(now()) @map("created_at")
  updatedAt               DateTime         @updatedAt @map("updated_at")
  
  maintenanceRecords      MaintenanceRecord[]
  expensesSubmitted       Expense[]        @relation("ExpenseSubmitter")
  expensesApproved        Expense[]        @relation("ExpenseApprover")
  budgetRequestsSubmitted BudgetRequest[]  @relation("BudgetRequestSubmitter")
  budgetRequestsApproved  BudgetRequest[]  @relation("BudgetRequestApprover")
  revenueRecords          RevenueRecord[]
  invoicesGenerated       Invoice[]
  paymentsRecorded        PaymentHistory[]

  @@map("users")
}

model Resort {
  id                    String                 @id @default(uuid())
  name                  String
  contactName           String?                @map("contact_name")
  contactEmail          String?                @map("contact_email")
  contactPhone          String?                @map("contact_phone")
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  
  profitSharingConfigs  ProfitSharingConfig[]
  assets                Asset[]
  revenueRecords        RevenueRecord[]
  invoices              Invoice[]

  @@map("resorts")
}

model ProfitSharingConfig {
  id               String        @id @default(uuid())
  resortId         String        @map("resort_id")
  assetCategory    AssetCategory @map("asset_category")
  dkuPercentage    Decimal       @map("dku_percentage") @db.Decimal(5, 2)
  resortPercentage Decimal       @map("resort_percentage") @db.Decimal(5, 2)
  effectiveFrom    DateTime      @map("effective_from") @db.Date
  createdAt        DateTime      @default(now()) @map("created_at")
  
  resort           Resort        @relation(fields: [resortId], references: [id])

  @@unique([resortId, assetCategory, effectiveFrom])
  @@map("profit_sharing_configs")
}

model Asset {
  id                 String              @id @default(uuid())
  name               String
  category           AssetCategory
  resortId           String              @map("resort_id")
  purchaseDate       DateTime            @map("purchase_date") @db.Date
  purchaseCost       Decimal             @map("purchase_cost") @db.Decimal(15, 2)
  status             AssetStatus         @default(ACTIVE)
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  
  resort             Resort              @relation(fields: [resortId], references: [id])
  maintenanceRecords MaintenanceRecord[]

  @@map("assets")
}

model MaintenanceRecord {
  id          String          @id @default(uuid())
  assetId     String          @map("asset_id")
  type        MaintenanceType
  description String          @db.Text
  startDate   DateTime        @map("start_date")
  endDate     DateTime?       @map("end_date")
  laborCost   Decimal         @default(0) @map("labor_cost") @db.Decimal(15, 2)
  performedBy String          @map("performed_by")
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")
  
  asset       Asset           @relation(fields: [assetId], references: [id])
  performer   User            @relation(fields: [performedBy], references: [id])
  spareParts  SparePart[]

  @@map("maintenance_records")
}

model SparePart {
  id                   String            @id @default(uuid())
  maintenanceRecordId  String            @map("maintenance_record_id")
  partName             String            @map("part_name")
  quantity             Int
  unitCost             Decimal           @map("unit_cost") @db.Decimal(15, 2)
  totalCost            Decimal           @map("total_cost") @db.Decimal(15, 2)
  createdAt            DateTime          @default(now()) @map("created_at")
  
  maintenanceRecord    MaintenanceRecord @relation(fields: [maintenanceRecordId], references: [id])

  @@map("spare_parts")
}

model Expense {
  id               String          @id @default(uuid())
  category         ExpenseCategory
  description      String          @db.Text
  amount           Decimal         @db.Decimal(15, 2)
  date             DateTime        @db.Date
  submittedBy      String          @map("submitted_by")
  status           ApprovalStatus  @default(PENDING)
  approvedBy       String?         @map("approved_by")
  approvalDate     DateTime?       @map("approval_date")
  approvalComments String?         @map("approval_comments") @db.Text
  createdAt        DateTime        @default(now()) @map("created_at")
  updatedAt        DateTime        @updatedAt @map("updated_at")
  
  submitter        User            @relation("ExpenseSubmitter", fields: [submittedBy], references: [id])
  approver         User?           @relation("ExpenseApprover", fields: [approvedBy], references: [id])

  @@map("expenses")
}

model BudgetRequest {
  id               String          @id @default(uuid())
  category         ExpenseCategory
  amount           Decimal         @db.Decimal(15, 2)
  justification    String          @db.Text
  submittedBy      String          @map("submitted_by")
  status           ApprovalStatus  @default(PENDING)
  approvedBy       String?         @map("approved_by")
  approvalDate     DateTime?       @map("approval_date")
  approvalComments String?         @map("approval_comments") @db.Text
  createdAt        DateTime        @default(now()) @map("created_at")
  updatedAt        DateTime        @updatedAt @map("updated_at")
  
  submitter        User            @relation("BudgetRequestSubmitter", fields: [submittedBy], references: [id])
  approver         User?           @relation("BudgetRequestApprover", fields: [approvedBy], references: [id])

  @@map("budget_requests")
}

model RevenueRecord {
  id            String        @id @default(uuid())
  resortId      String        @map("resort_id")
  assetCategory AssetCategory @map("asset_category")
  date          DateTime      @db.Date
  amount        Decimal       @db.Decimal(15, 2)
  recordedBy    String        @map("recorded_by")
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")
  
  resort        Resort        @relation(fields: [resortId], references: [id])
  recorder      User          @relation(fields: [recordedBy], references: [id])

  @@unique([resortId, assetCategory, date])
  @@map("revenue_records")
}

model Invoice {
  id            String             @id @default(uuid())
  invoiceNumber String             @unique @map("invoice_number")
  resortId      String             @map("resort_id")
  startDate     DateTime           @map("start_date") @db.Date
  endDate       DateTime           @map("end_date") @db.Date
  totalRevenue  Decimal            @map("total_revenue") @db.Decimal(15, 2)
  dkuShare      Decimal            @map("dku_share") @db.Decimal(15, 2)
  resortShare   Decimal            @map("resort_share") @db.Decimal(15, 2)
  status        InvoiceStatus      @default(DRAFT)
  generatedBy   String             @map("generated_by")
  createdAt     DateTime           @default(now()) @map("created_at")
  updatedAt     DateTime           @updatedAt @map("updated_at")
  
  resort        Resort             @relation(fields: [resortId], references: [id])
  generator     User               @relation(fields: [generatedBy], references: [id])
  lineItems     InvoiceLineItem[]
  payments      PaymentHistory[]

  @@map("invoices")
}

model InvoiceLineItem {
  id               String        @id @default(uuid())
  invoiceId        String        @map("invoice_id")
  assetCategory    AssetCategory @map("asset_category")
  revenue          Decimal       @db.Decimal(15, 2)
  dkuPercentage    Decimal       @map("dku_percentage") @db.Decimal(5, 2)
  resortPercentage Decimal       @map("resort_percentage") @db.Decimal(5, 2)
  dkuAmount        Decimal       @map("dku_amount") @db.Decimal(15, 2)
  resortAmount     Decimal       @map("resort_amount") @db.Decimal(15, 2)
  createdAt        DateTime      @default(now()) @map("created_at")
  
  invoice          Invoice       @relation(fields: [invoiceId], references: [id])

  @@map("invoice_line_items")
}

model PaymentHistory {
  id            String   @id @default(uuid())
  invoiceId     String   @map("invoice_id")
  paymentDate   DateTime @map("payment_date") @db.Date
  amount        Decimal  @db.Decimal(15, 2)
  paymentMethod String?  @map("payment_method")
  notes         String?  @db.Text
  recordedBy    String   @map("recorded_by")
  createdAt     DateTime @default(now()) @map("created_at")
  
  invoice       Invoice  @relation(fields: [invoiceId], references: [id])
  recorder      User     @relation(fields: [recordedBy], references: [id])

  @@map("payment_history")
}
